<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/d2-touch/blog/rss.xml" title="D2Touch (DHIS2 Flutter SDK) Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/d2-touch/blog/atom.xml" title="D2Touch (DHIS2 Flutter SDK) Blog Atom Feed"><title data-react-helmet="true">Workflow | D2Touch (DHIS2 Flutter SDK)</title><meta data-react-helmet="true" property="og:url" content="https://udsm-dhis2-lab.github.io/d2-touch/docs/workflow"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Workflow | D2Touch (DHIS2 Flutter SDK)"><meta data-react-helmet="true" name="description" content="Currently, the SDK is primarily oriented to build apps that work in an offline mode. In short, the SDK maintains a local database instance that is used to get the work done locally (create forms, manage data, ...). When requested by the client, this local database is synchronized with the server."><meta data-react-helmet="true" property="og:description" content="Currently, the SDK is primarily oriented to build apps that work in an offline mode. In short, the SDK maintains a local database instance that is used to get the work done locally (create forms, manage data, ...). When requested by the client, this local database is synchronized with the server."><link data-react-helmet="true" rel="shortcut icon" href="/d2-touch/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://udsm-dhis2-lab.github.io/d2-touch/docs/workflow"><link data-react-helmet="true" rel="alternate" href="https://udsm-dhis2-lab.github.io/d2-touch/docs/workflow" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://udsm-dhis2-lab.github.io/d2-touch/docs/workflow" hreflang="x-default"><link rel="stylesheet" href="/d2-touch/assets/css/styles.e760dd25.css">
<link rel="preload" href="/d2-touch/assets/js/styles.af9fa4f8.js" as="script">
<link rel="preload" href="/d2-touch/assets/js/runtime~main.55cc834a.js" as="script">
<link rel="preload" href="/d2-touch/assets/js/main.0a5d703f.js" as="script">
<link rel="preload" href="/d2-touch/assets/js/1.9e39f1ba.js" as="script">
<link rel="preload" href="/d2-touch/assets/js/2.4fae812d.js" as="script">
<link rel="preload" href="/d2-touch/assets/js/3.bde55d57.js" as="script">
<link rel="preload" href="/d2-touch/assets/js/1be78505.296c988f.js" as="script">
<link rel="preload" href="/d2-touch/assets/js/28.4f63c7f5.js" as="script">
<link rel="preload" href="/d2-touch/assets/js/935f2afb.70ae76b7.js" as="script">
<link rel="preload" href="/d2-touch/assets/js/17896441.b056f953.js" as="script">
<link rel="preload" href="/d2-touch/assets/js/195abf70.aceb4979.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/d2-touch/"><img src="/d2-touch/img/logo.svg" alt="D2Touch (DHIS2 Flutter SDK)" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/d2-touch/img/logo.svg" alt="D2Touch (DHIS2 Flutter SDK)" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">D2Touch (DHIS2 Flutter SDK)</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/d2-touch/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/udsm-dhis2-lab/d2-touch/tree/develop/docs/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/d2-touch/"><img src="/d2-touch/img/logo.svg" alt="D2Touch (DHIS2 Flutter SDK)" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/d2-touch/img/logo.svg" alt="D2Touch (DHIS2 Flutter SDK)" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">D2Touch (DHIS2 Flutter SDK)</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/d2-touch/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/udsm-dhis2-lab/d2-touch/tree/develop/docs/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/about">About this guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/getting-started">Getting Started</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Modules &amp; Repositories</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/query-builder">Query Builder</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/filters">Filters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/ordering">Ordering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/nested-fields">Nested Fields</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/helpers">Helpers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/module-list">Module List</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Developing with SDK</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/d2-touch/docs/workflow">Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/d2-touch/docs/settings">Settings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/d2-touch/docs/error-management">Error Management</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Engines</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/program-rule-engine">Program Rule Engine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/program-indicator-engine">Program Indicator Engine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/validation-rule-engine">Validation Rule Engine</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Misc</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/d2-touch/docs/database">Database</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Workflow</h1></header><div class="markdown"><p>Currently, the SDK is primarily oriented to build apps that work in an offline mode. In short, the SDK maintains a local database instance that is used to get the work done locally (create forms, manage data, ...). When requested by the client, this local database is synchronized with the server.</p><p>A typical workflow would be like this:</p><ol><li><strong>Login</strong></li><li><strong>Sync metadata:</strong> the SDK downloads a subset of the server metadata so it is available to be used at any time. Metadata sync is totally user-dependent (see <a href="#metadata-synchronization">Synchronization</a> for more details)</li><li><strong>Download data:</strong> if you want to have existing data available in the device even when offline, you can download and save existing tracker and aggregated data in the device.</li><li><strong>Do the work:</strong> at this point the app is able to create the data entry forms and show some existing data. Then the user can edit/delete/update data.</li><li><strong>Upload data:</strong> from time to time, the work done in the local database instance is sent to the server.</li><li><strong>Sync metadata:</strong> it is recommended to sync metadata quite often to detect changes in metadata configuration.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="loginlogout"></a>Login/Logout<a class="hash-link" href="#loginlogout" title="Direct link to heading">#</a></h2><p>Before interacting with the server it is required to login into the DHIS 2 instance. Currently, the SDK does only support one pair &quot;user - server&quot; simultaneously. That means that only one user can be authenticated in only one server at the same time.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly dart"><div tabindex="0" class="prism-code language-dart codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2TouchInstance.userModule().login(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    username: &quot;admin&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    password: &quot;district&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2TouchInstance.userModule().logOut();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>After a logout, the SDK keeps track of the last logged user so that it is able to differentiate recurring and new users. It also keeps a hash of the user credentials in order to authenticate the user even when there is no connectivity. Given that said, the login method will:</p><ul><li>If an authenticated user already exists: throw an error.</li><li>Else if <em>Online</em>:<ul><li>Try <strong>login online</strong>: the SDK will send the username and password to the API, which will determine whether they are correct. If successful:<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">- If no database exists: create new database with encryption value from server.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- If database for another [serverUrl, user] exists, delete it and create new database with encryption value from server. Not synced data of previously logged user will be permanently lost.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- If database for the current [serverUrl, user] pair exists, open the database and encrypt or decrypt database if encryption status has changed in the server.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li>If user account has been disabled in server: delete database and throw an error.</li></ul></li><li>Else if <em>Offline</em>:<ul><li>If the [serverUrl, user] pair was the last authenticated:<ul><li>Try <strong>login offline</strong>: the SDK will verify that the credentials are the same as the last provided, which were previously validated by the API.</li></ul></li><li>If the [serverUrl, user] pair was not the last authenticated: throw an error</li></ul></li></ul><p>Calling module or repository methods before a successful login or after a logout will result in &quot;Database not created&quot; errors.</p><p>Logout method removes user credentials, so a new login is required before any interaction with the server. Metadata and data is preserved so a user is able to logout/login without losing any information.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="metadata-synchronization"></a>Metadata synchronization<a class="hash-link" href="#metadata-synchronization" title="Direct link to heading">#</a></h2><p>Metadata synchronization is usually the first step after login. It fetches and persists the metadata needed by the current user. To launch metadata synchronization we must execute:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.metadataModule().download();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In order to save bandwidth usage and storage space, the SDK does not synchronize all the metadata in the server but a subset. This subset is defined as the metadata required by the user in order to perform data entry tasks: render programs and datasets, execute program rules, evaluate in-line program indicators, etc.</p><p>Based on that, metadata sync includes the following elements:</p><table><thead><tr><th>Element</th><th>Condition or scope</th></tr></thead><tbody><tr><td>System info</td><td>All</td></tr><tr><td>System settings</td><td>KeyFlag, KeyStyle</td></tr><tr><td>User settings</td><td>KeyDbLocale, KeyUiLocale</td></tr><tr><td>User</td><td>Only authenticated user</td></tr><tr><td>UserRole</td><td>Roles assigned to authenticated user</td></tr><tr><td>Authority</td><td>Authorities assigned to authenticated user</td></tr><tr><td>Program</td><td>Programs that user has (at least) read data access to and that are assigned to any orgunit visible by the user</td></tr><tr><td>RelationshipTypes</td><td>All</td></tr><tr><td>OptionGroups</td><td>Only if server is greater than 2.29</td></tr><tr><td>DataSet</td><td>DataSets that user has (at least) read data access to and that are assigned to any orgunit visible by the user</td></tr><tr><td>Validation rules</td><td>Validation rules associated to the dataSets</td></tr><tr><td>Indicators</td><td>Indicators assigned to downloaded dataSets</td></tr><tr><td>OrganisationUnit</td><td>OrganisationUnits in CAPTURE or SEARCH scope (descendants included)</td></tr><tr><td>OrganisationUnitGroup</td><td>Groups assigned to downloaded organisationUnits</td></tr><tr><td>OrganisationUnitLevel</td><td>All</td></tr><tr><td>Constant</td><td>All</td></tr><tr><td>SMS Module metadata</td><td>Only if SMS module enabled</td></tr></tbody></table><p>In the case of Programs and DataSets, metadata sync includes all the metadata related to them: stages, sections, dataElements, options, categories, etc. Those elements that are not related to any Program or DataSet are not included.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="corrupted-configurations"></a>Corrupted configurations<a class="hash-link" href="#corrupted-configurations" title="Direct link to heading">#</a></h3><p>This partial metadata synchronization may expose server-side misconfiguration issues. For example, a ProgramRuleVariable pointing to a DataElement that does not belong to the program anymore. Due to the use of database-level constraints, this misconfiguration will appear as a Foreign Key error.</p><p>The SDK does not fail the synchronization, but it stores the errors in a table for inspection. These errors can be accessed by:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.maintenanceModule().foreignKeyViolations()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="data-states"></a>Data states<a class="hash-link" href="#data-states" title="Direct link to heading">#</a></h2><p>Data objects have a read-only <code>state</code> property that indicates the current state of the object in terms of synchronization with the server. This state is maintained by the SDK.</p><p>The possible states are:</p><ul><li><strong>SYNCED</strong>. The element is synced with the server. There are no local changes for this value.</li><li><strong>TO_POST</strong>. Data created locally that does not exist in the server yet.</li><li><strong>TO_UPDATE</strong>. Data modified locally that exists in the server.</li><li><strong>UPLOADING</strong>. Data is being uploaded. If it is modified before receiving any server response, its state is back to <code>TO_UPDATE</code>. When the server response arrives, its state does not change to <code>SYNCED</code>, but it remains in <code>TO_UPDATE</code> to indicate that there are local changes.</li><li><strong>SENT_BY_SMS</strong>. Data is sent by sms and there is no server response yet. Some servers do not have the capability to send a response, so this state means that data has been sent, but we do not know if it has been correctly imported in the server or not.</li><li><strong>SYNCED_BY_SMS</strong>. Data is sent by sms and there is a successful response from the server.</li><li><strong>ERROR</strong>. Data that received an error from the server after the last upload.</li><li><strong>WARNING</strong>. Data that received a warning from the server after the last upload.</li></ul><p>Additionally, in <code>TrackedEntityInstance</code> we might have:</p><ul><li><strong>RELATIONSHIP</strong>. This TrackedEntityInstance has been downloaded with the sole purpose of fulfilling a relationship to another TEI. This <code>RELATIONSHIP</code> TEI only has basic information (uid, type, etc) and the list of TrackedEntityAttributes to be able to print meaningful information about the relationship. Other data such as enrollments, events or relationships are not downloaded for this TEI. Also, this TEI cannot be modified or uploaded to the server.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tracker-data"></a>Tracker data<a class="hash-link" href="#tracker-data" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tracker-data-download"></a>Tracker data download<a class="hash-link" href="#tracker-data-download" title="Direct link to heading">#</a></h3><blockquote><p><strong>Important</strong></p><p>See <a href="#settings_app">Settings App</a> section to know how this application can be used to control synchronization parameters.</p></blockquote><p>By default, the SDK only downloads TrackedEntityInstances and Events
that are located in user capture scope, but it is also possible to
download TrackedEntityInstances in search scope.</p><p>The tracked entity module contains the
<code>TrackedEntityInstanceDownloader</code>. The downloader follows a builder
pattern which allows the download of tracked entity instances filtering by
<strong>different parameters</strong> as well as defining some <strong>limits</strong>. The same
behavior can be found within the event module for events.</p><p>The downloader tracks the latest successful download in order to avoid
downloading unmodified data. It makes use of paging with a best effort
strategy: in case a page fails to be downloaded or persisted, it is
skipped and it will continue with the next pages.</p><p>This is an example of how it can be used.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.trackedEntityModule().trackedEntityInstanceDownloader()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .[filters]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .[limits]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .download()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.eventModule().eventDownloader()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .[filters]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .[limits]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .download()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Currently, it is possible to specify the next filters:</p><ul><li><code>byProgramUid()</code>. Filters by program uid and downloads the not synced
objects inside the program.</li><li><code>byUid()</code>. Filters by the tracked entity instance uid and downloads a
unique object. This filter can be used to download the tracked entity
instances found within search scope. (Only for tracked entity
instances).</li></ul><p>The downloader also allows to limit the number of downloaded objects.
These limits can also be combined with each other.</p><ul><li><code>limit()</code>. Limit the maximum number of objects to download.</li><li><code>limitByProgram()</code>. Take the established limit and apply it to each
program. The number of objects that will be downloaded will be the one
obtained by multiplying the limit set by the number of user programs.</li><li><code>limitByOrgunit()</code>. Take the established limit and apply it for each
organisation unit. The number of objects that will be downloaded will
be the one obtained by multiplying the limit set by the number of user
organisation units.</li></ul><p>The next snippet of code shows an example of the
TrackedEntityInstanceDownloader usage.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.trackedEntityModule().trackedEntityInstanceDownloader()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .byProgramUid(&quot;program-uid&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .limitByOrgunit(true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .limitByProgram(true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .limit(50)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .download()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Additionally, if you want the images associated to <code>Image</code> data values available to be downloaded in the device, you must download them. See <a href="#dealing-with-fileresources"><em>Dealing with FileResources</em></a> section for more details.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tracker-data-search"></a>Tracker data search<a class="hash-link" href="#tracker-data-search" title="Direct link to heading">#</a></h3><p>DHIS2 has a functionality to filter TrackedEntityInstances by related
properties, like attributes, organisation units, programs or enrollment
dates. The Sdk provides the <code>TrackedEntityInstanceQueryCollectionRepository</code>
with methods that allow the download of tracked entity
instances within the search scope. It can be found inside the tracked entity instance module.</p><p>The tracked entity instance query is a powerful tool that follows a
builder pattern and allows the download of tracked entity instances
filtering by <strong>different parameters</strong>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.trackedEntityModule().trackedEntityInstanceQuery()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .[repository mode]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .[filters]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .get()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The source where the TEIs are retrieved from is defined by the <strong>repository mode</strong>.
These are the different repository modes available:</p><ul><li><code>onlineOnly()</code>. Only TrackedEntityInstances coming from the server are
returned in the list. Internet connection is required to use this mode.</li><li><code>offlineOnly()</code>. Only TrackedEntityInstances coming from local
database are returned in the list.</li><li><code>onlineFirst()</code>. TrackedEntityInstances coming from the server are
returned in first place. Once there are no more results online, it
continues with TrackedEntityInstances in the local database. Internet
connection is required to use this mode.</li><li><code>offlineFirst()</code>. TrackedEntityInstances coming from local database
are returned in first place. Once there are no more results, it continues
with TrackedEntityInstances coming from the server. This method may
speed up the initial load. Internet connection is required to use this
mode.</li></ul><p>This repository follows the same syntax as other repositories.
Additionally, the repository offers different strategies to fetch data:</p><ul><li><p><code>byAttribute()</code>. This method adds an <em>attribute</em> filter to the query.
If this method is called several times, conditions are appended with an AND
connector. For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.trackedEntityModule().trackedEntityInstanceQuery()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .byAttribute(&quot;uid1&quot;).eq(&quot;value1&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .byAttribute(&quot;uid2&quot;).eq(&quot;value2&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .get()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>That means that the instance must have attribute <code>uid1</code> with value
<code>value1</code> <strong>AND</strong> attribute <code>uid2</code> with value <code>value2</code>.</p></li><li><p><code>byFilter()</code>. This method adds a <em>filter</em> to the query. If this
method is called several times, conditions are appended with an AND
connector. For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.trackedEntityModule().trackedEntityInstanceQuery()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .byFilter(&quot;uid1&quot;).eq(&quot;value1&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .byFilter(&quot;uid2&quot;).eq(&quot;value2&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .get()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>That means that the instance must have attribute <code>uid1</code> with value
<code>value1</code> <strong>AND</strong> attribute <code>uid2</code> with value <code>value2</code>.</p></li><li><p><code>byQuery()</code>. Search tracked entity instances with <strong>any</strong> attribute
matching the query.</p></li><li><p><code>byProgram()</code>. Filter by enrollment program. Only one program can be
specified.</p></li><li><p><code>byOrgUnits()</code>. Filter by tracked entity instance organisation units.
More than one organisation unit can be specified.</p></li><li><p><code>byOrgUnitMode()</code>. Define the organisation unit mode. The possible
modes are the next:</p><ul><li><strong>SELECTED</strong>. Specified units only.</li><li><strong>CHILDREN</strong>. Immediate children of specified units, including
specified units.</li><li><strong>DESCENDANTS</strong>. All units in sub-hierarchy of specified units,
including specified units.</li><li><strong>ACCESSIBLE</strong>. All organisation units accessible by the user
(search scope).</li><li><strong>ALL</strong>. All units in system. Requires authority.</li></ul></li><li><p><code>byProgramStartDate()</code>. Define an enrollment start date. It only
applies if a program has been specified.</p></li><li><p><code>byProgramEndDate()</code>. Define an enrollment end date. It only applies
if a program has been specified.</p></li><li><p><code>byTrackedEntityType()</code>. Filter by TrackedEntityType. Only one type
can be specified.</p></li><li><p><code>byIncludeDeleted()</code>. Whether to include or not deleted tracked entity
instances. Currently, this filter only applies to <strong>offline</strong>
instances.</p></li><li><p><code>byStates()</code>. Filter by sync status. Using this filter forces
<strong>offline only</strong> mode.</p></li></ul><p>Example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.trackedEntityModule().trackedEntityInstanceQuery()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                .byOrgUnits().eq(&quot;orgunitUid&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                .byOrgUnitMode().eq(OrganisationUnitMode.DESCENDANTS)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                .byProgram().eq(&quot;programUid&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                .byAttribute(&quot;attributeUid&quot;).like(&quot;value&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                .offlineFirst()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><blockquote><p><strong>Important</strong></p><p>TrackedEntityInstances retrieved using this repository are not persisted in the database. It is possible
to fully download them using the <code>byUid()</code> filter of the <code>TrackedEntityInstanceDownloader</code> within the tracked entity instance module.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tracker-data-write"></a>Tracker data write<a class="hash-link" href="#tracker-data-write" title="Direct link to heading">#</a></h3><p>In general, there are two different cases to manage data creation/edition/deletion: the case where the object is identifiable (that is, it has an <code>uid</code> property) and the case where the object is not identifiable.</p><p><strong>Identifiable objects</strong> (TrackedEntityInstance, Enrollment, Event). These repositories have a <code>uid()</code> method that gives you access to edition methods for a single object. In case the object does not exist yet, it is required to create it first. A typical workflow to create/edit an object would be:</p><ul><li>Use the <code>CreateProjection</code> class to add a new instance in the repository.</li><li>Save the uid returned by this method.</li><li>Use the <code>uid()</code> method with the previous uid to get access to edition methods.</li></ul><p>And in code this would look like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">String eventUid = d2.eventModule().events().add(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    EventCreateProjection.create(&quot;enrollment&quot;, &quot;program&quot;, &quot;programStage&quot;, &quot;orgUnit&quot;, &quot;attCombo&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.eventModule().events().uid(eventUid).setStatus(COMPLETED);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Non-identifiable objects</strong> (TrackedEntityAttributeValue, TrackedEntityDataValue). These repositories have a <code>value()</code> method that gives you access to edition methods for a single object. The parameters accepted by this method are the parameters that unambiguously identify a value.</p><p>For example, writing a TrackedEntityDataValue would be like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.trackedEntityModule().trackedEntityDataValues().value(eventUid, dataElementid).set(“5”);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Data values of type <code>Image</code> involve an additional step to create/update/read the associated file resource. More details in the <a href="#dealing-with-fileresources"><em>Dealing with FileResources</em></a> section below.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tracker-data-upload"></a>Tracker data upload<a class="hash-link" href="#tracker-data-upload" title="Direct link to heading">#</a></h3><p>TrackedEntityInstance and Event repositories have an <code>upload()</code> method to upload Tracker data and Event data (without registration) respectively. If the repository scope has been reduced by filter methods, only filtered objects will be uploaded.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.( trackedEntityModule() | eventModule() )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .[ filters ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .upload();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Data whose state is <code>ERROR</code> or <code>WARNING</code> cannot be uploaded. It is required to solve the conflicts before attempting a new upload: this means to do a modification in the problematic data, which forces their state back to <code>TO_UPDATE</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tracker-conflicts"></a>Tracker conflicts<a class="hash-link" href="#tracker-conflicts" title="Direct link to heading">#</a></h4><p>Server response is parsed to ensure that data has been correctly uploaded to the server. In case the server response includes import conflicts, these conflicts are stored in the database, so the app can check them and take an action to solve them.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.importModule().trackerImportConflicts()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Conflicts linked to a TrackedEntityInstance, Enrollment or Event are automatically removed after a successful upload of the object.</p><p>The SDK tries to identify the confliction dataElement or attribute by parsing the server response. If so, it also stores the value of the element when the conflict happened so that the application can highlight the element in form when the value has not been fixed yet.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tracker-data-reserved-values"></a>Tracker data: reserved values<a class="hash-link" href="#tracker-data-reserved-values" title="Direct link to heading">#</a></h3><p>Tracked Entity Attributes configured as <strong>unique</strong> and <strong>automatically generated</strong> are generated by the server following a pattern defined by the user. These values can only be generated by the server, which means that we need to reserve them in advance so we can make use of them when operating offline.</p><p>The app is responsible for reserving generated values before going offline. This can be triggered by:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Reserve values for all the unique and automatically generated trackedEntityAttributes.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.trackedEntityModule().reservedValueManager().downloadAllReservedValues(numValuesToFillUp)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Reserve values for a particular trackedEntityAttribute.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.trackedEntityModule().reservedValueManager().downloadReservedValues(&quot;attributeUid&quot;, numValuesToFillUp)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Depending on how long the app expects to be offline, it can decide the quantity of values to reserve. In case the attribute pattern is dependant on the orgunit code, the SDK will reserve values for all the relevant orgunits. More details about the logic in Javadoc.</p><p>Reserved values can be obtained by:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.trackedEntityModule().reservedValueManager().getValue(&quot;attributeUid&quot;, &quot;orgunitUid&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tracker-data-relationships"></a>Tracker data: relationships<a class="hash-link" href="#tracker-data-relationships" title="Direct link to heading">#</a></h3><p>Currently the SDK only supports relatinships from TEI to TEI. They accessed by using the relationships module.</p><p>Query relationships associated to a TEI.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.relationshipModule().relationships().getByItem(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    RelationshipHelper.teiItem(&quot;trackedEntityInstanceUid&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In the same module you can create new relationships using this method:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Relationship relationship = RelationshipHelper.teiToTeiRelationship(&quot;fromTEIUid&quot;, &quot;toTEIUid&quot;, &quot;relationshipTypeUid&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.relationshipModule().relationships().add(relationship);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If the related trackedEntityInstance does not exist yet and there are attribute values that must be inherited, you can use the following method to inherit attribute values from one TEI to another in the context of a certain program. Only those attribute marked as <code>inherit</code> will be inherited.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.trackedEntityModule().trackedEntityInstanceService()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .inheritAttributes(&quot;fromTeiUid&quot;, &quot;toTeiUid&quot;, &quot;programUid&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="aggregated-data"></a>Aggregated data<a class="hash-link" href="#aggregated-data" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="aggregated-data-download"></a>Aggregated data download<a class="hash-link" href="#aggregated-data-download" title="Direct link to heading">#</a></h3><blockquote><p><strong>Important</strong></p><p>See <a href="#settings_app">Settings App</a> section to know how this application can be used to control synchronization parameters.</p></blockquote><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.aggregatedModule().data().download()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>By default, the SDK downloads <strong>aggregated data values</strong>, <strong>dataset
complete registration values</strong> and <strong>approvals</strong> corresponding to:</p><ul><li><p><strong>DataSets</strong>: all available dataSets (those the user has at least read
data access to).</p></li><li><p><strong>OrganisationUnits</strong>: capture scope.</p></li><li><p><strong>Periods</strong>: all available periods, which means at least:</p><ul><li>Days: last 60 days.</li><li>Weeks: last 13 weeks (including starting day variants).</li><li>Biweekly: last 13 bi-weeks.</li><li>Monthly: last 12 months.</li><li>Bimonthly: last 6 bi-months.</li><li>Quarters: last 5 quarters.</li><li>Sixmonthly: last 5 six-months (starting in January and April).</li><li>Yearly: last 5 years (including financial year variants).</li></ul><p>In addition, if any dataset allows data entry for <strong>future periods</strong>,
the Sdk will download the data for those open periods and store them. </p></li></ul><p>The Sdk also keeps track of the latest successful download in order to
avoid downloading unmodified server data.</p><p>In the download of <strong>data approvals</strong>, workflow and attribute option
combination identifiers will be considered in addition to the
organisation units and periods. The different possible states for data
approval are:</p><ul><li><code>UNAPPROVABLE</code>. Data approval does not apply to this selection. (Data
is neither <em>approved</em> nor <em>unapproved</em>).</li><li><code>UNAPPROVED_WAITING</code>. Data could be approved for this selection, but
is waiting for some lower-level approval before it is ready to be
approved.</li><li><code>UNAPPROVED_ELSEWHERE</code>. Data is unapproved and is waiting for
approval somewhere else (can not be approved here).</li><li><code>UNAPPROVED_READY</code>. Data is unapproved, and is ready to be approved
for this selection.</li><li><code>UNAPPROVED_ABOVE</code>. Data is unapproved above.</li><li><code>APPROVED_HERE</code>. Data is approved, and was approved here (so could be
unapproved here).</li><li><code>APPROVED_ELSEWHERE</code>. Data is approved, but was not approved here (so
cannot be unapproved here).</li><li><code>APPROVED_ABOVE</code>. Data is approved above.</li><li><code>ACCEPTED_HERE</code>. Data is approved and accepted here (so could be
unapproved here).</li><li><code>ACCEPTED_ELSEWHERE</code>. Data is approved and accepted, but elsewhere.</li></ul><p>Data approvals are downloaded only for versions greater than 2.29.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="aggregated-data-write"></a>Aggregated data write<a class="hash-link" href="#aggregated-data-write" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="periods"></a>Periods<a class="hash-link" href="#periods" title="Direct link to heading">#</a></h4><p>In order to write data values or data set complete registrations, it&#x27;s mandatory to provide a period id. Periods are stored in a table in the database and
the provided period ids must be already present in that table, otherwise, a Foreign Key error will be thrown. To prevent that situation, the <code>PeriodHelper</code> is
exposed inside the <code>PeriodModule</code>. Before adding aggregated data related to a dataSet, the following method must be called:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Single&lt;List&lt;Period&gt;&gt; periods = d2.periodModule().periodHelper().getPeriodsForDataSet(&quot;dataSetUid&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This will ensure that: </p><ol><li>The app will pick one of the given periods, preventing malformed or wrong periods.</li><li>The app will only be able to pick the future periods defined by the field <code>DataSet.openFuturePeriods</code>.</li><li>The app will only be able to pick the past periods defined based on the limits declared on the section Aggregated Data Download.</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="data-value"></a>Data value<a class="hash-link" href="#data-value" title="Direct link to heading">#</a></h4><p>DataValueCollectionRepository has a <code>value()</code> method that gives access to edition methods. The parameters accepted by this method are the parameters that unambiguously identify a value.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DataValueObjectRepository valueRepository = d2.dataValueModule().dataValues()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .value(&quot;periodId&quot;, &quot;orgunitId&quot;, &quot;dataElementId&quot;, &quot;categoryOptionComboId&quot;, &quot;attributeOptionComboId&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">valueRepository.set(&quot;value&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="data-set-complete-registration"></a>Data set complete registration<a class="hash-link" href="#data-set-complete-registration" title="Direct link to heading">#</a></h4><p>The Sdk provides within the data set module a collection repository for
data set complete registrations. This repository contains methods to add
new completions and delete them.</p><p>To add a new data set complete registration is available an <code>add()</code>
method:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.dataSetModule().dataSetCompleteRegistrations()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .add(dataSetCompleteRegistration);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In order to remove them from the database, the repository has a <code>value()</code>
method that gives access to deletion methods (<code>delete()</code> and
<code>deleteIfExist()</code>). The parameters accepted by this method are the
parameters that unambiguously identify the data set complete
registration.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.dataSetModule().dataSetCompleteRegistrations()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .value(&quot;periodId&quot;, &quot;orgunitId&quot;, &quot;dataSetUid&quot;,&quot;attributeOptionCombo&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .delete()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="aggregated-data-upload"></a>Aggregated data upload<a class="hash-link" href="#aggregated-data-upload" title="Direct link to heading">#</a></h3><p>DataValueCollectionRepository has an <code>upload()</code> method to upload aggregated data values.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.dataValueModule().dataValues().upload();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dataset-instances"></a>DataSet instances<a class="hash-link" href="#dataset-instances" title="Direct link to heading">#</a></h3><p>A DataSetInstance in the SDK is a handy representation of the existing aggregated data. A DataSetInstance represents a unique combination of DataSet - Period - Orgunit - AttributeOptionCombo and includes extra information like sync state, value count or displayName for some properties.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.dataSetModule().dataSetInstances()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .[ filters ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .get()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// For example</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.dataSetModule().dataSetInstances()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .byDataSetUid().eq(&quot;datasetUid&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .byOrganisationUnitUid().eq(&quot;orgunitUid&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .byPeriod().in(&quot;201901&quot;, &quot;201902&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .get();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If you only need a high level overview of the aggregated data status, you can use the repository <code>DataSetInstanceSummary</code>. It accepts the same filters and returns a count of <code>DataSetInstance</code> for each combination.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dealing-with-fileresources"></a>Dealing with FileResources<a class="hash-link" href="#dealing-with-fileresources" title="Direct link to heading">#</a></h2><p>The SDK offers a module (the <code>FileResourceModule</code>) and two helpers (the <code>FileResourceDirectoryHelper</code> and <code>FileResizerHelper</code>) that allow to work with files.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="file-resources-module"></a>File resources module<a class="hash-link" href="#file-resources-module" title="Direct link to heading">#</a></h3><p>This module contains methods to download the file resources associated with the downloaded data and the file resources collection repository of the database.</p><ul><li><p><strong>File resources download</strong>.
The <code>download()</code> method will search for the tracked entity attribute values ​​and tracked entity data values ​​whose tracked entity attribute type and data element type are of the image type and whose file resource has not been previously downloaded and the method will download the file resources associated.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.fileResourceModule().download();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  After downloading the files, you can obtain the different file resources downloaded through the repository.</p></li><li><p><strong>File resource collection repository</strong>.
Through this repository it is possible to request files, save new ones and upload them to the server. </p><ul><li><p><strong>Get</strong>. It behaves in a similar fashion to any other Sdk repository. It allows to get collections by applying different filters if desired.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.fileResourceModule().fileResources()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .[ filters ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .get()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p><strong>Add</strong>. To save a file you have to add it using the <code>add()</code> method of the repository by providing an object of type <code>File</code>. The <code>add()</code> method will return the uid that was generated when adding the file. This uid should be used to update the tracked entity attribute value or the tracked entity data value associated with the file resource.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.fileResourceModule().fileResources()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .add(file); // Single&lt;String&gt; The fileResource uid</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p><strong>Upload</strong>. Calling the <code>upload()</code> method will trigger a series of successive calls in which all non-synchronized files will be sent to the server. After each upload, the server response will be processed. The server will provide a new uid to the file resource and the Sdk will automatically rename the file and update the <code>FileResource</code> object and the tracked entity attribute values ​​or tracked entity data values ​​associated with it.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">d2.fileResourceModule().fileResources()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .upload()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="file-resizer-helper"></a>File resizer helper<a class="hash-link" href="#file-resizer-helper" title="Direct link to heading">#</a></h3><p>The Sdk provides a helper to resize image files (<code>FileResizerHelper</code>). This helper contains a <code>resizeFile()</code> method that accepts the file you want to reduce and the dimension to which you want to reduce it.</p><p>The possible dimensions are in the following table.</p><table><thead><tr><th>Small</th><th>Medium</th><th>Large</th></tr></thead><tbody><tr><td>256px</td><td>512px</td><td>1024px</td></tr></tbody></table><p>The helper takes the file, measures the height and width of the image, determines which of the two sides is larger and reduces the largest of the sides to the given dimension and the other side is scaled to its proportional size. <strong>Image scaling will always keep the proportions</strong>.</p><p>In the event that the last image is smaller than the dimension to which you want to resize it, the same file will be returned without being modified.</p><p>The <code>resizeFile()</code> method will return a new file located in the same parent directory of the file to be resized under the name <code>resized-DIMENSION-</code> + the name of the file without resizing.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="file-resource-directory-helper"></a>File resource directory helper<a class="hash-link" href="#file-resource-directory-helper" title="Direct link to heading">#</a></h3><p>The <code>FileResourceDirectoryHelper</code> helper class provides two methods.</p><ul><li><p><code>getFileResourceDirectory()</code>. This method returns a <code>File</code> object whose path points to the <code>sdk_resources</code> directory where the Sdk will save the files associated with the file resources.</p></li><li><p><code>getFileCacheResourceDirectory()</code>. This method returns a <code>File</code> object whose path points to the <code>sdk_cache_resources</code> directory. This should be the place where volatile files are stored, such as camera photos or images to be resized. Since the directory is contained in the cache directory, Android may auto-delete the files in the cache directory once the system is about to run out of memory. Third party applications can also delete files from the cache directory. Even the user can manually clear the cache from Settings. However, the fact that the cache can be cleared in the methods explained above should not mean that the cache will automatically get cleared; therefore, the cache will need to be tidied up from time to time proactively.</p></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/udsm-dhis2-lab/d2-touch/edit/develop/docs/docs/workflow.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/d2-touch/docs/module-list"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Module List</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/d2-touch/docs/settings"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Settings »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#loginlogout" class="table-of-contents__link">Login/Logout</a></li><li><a href="#metadata-synchronization" class="table-of-contents__link">Metadata synchronization</a><ul><li><a href="#corrupted-configurations" class="table-of-contents__link">Corrupted configurations</a></li></ul></li><li><a href="#data-states" class="table-of-contents__link">Data states</a></li><li><a href="#tracker-data" class="table-of-contents__link">Tracker data</a><ul><li><a href="#tracker-data-download" class="table-of-contents__link">Tracker data download</a></li><li><a href="#tracker-data-search" class="table-of-contents__link">Tracker data search</a></li><li><a href="#tracker-data-write" class="table-of-contents__link">Tracker data write</a></li><li><a href="#tracker-data-upload" class="table-of-contents__link">Tracker data upload</a></li><li><a href="#tracker-data-reserved-values" class="table-of-contents__link">Tracker data: reserved values</a></li><li><a href="#tracker-data-relationships" class="table-of-contents__link">Tracker data: relationships</a></li></ul></li><li><a href="#aggregated-data" class="table-of-contents__link">Aggregated data</a><ul><li><a href="#aggregated-data-download" class="table-of-contents__link">Aggregated data download</a></li><li><a href="#aggregated-data-write" class="table-of-contents__link">Aggregated data write</a></li><li><a href="#aggregated-data-upload" class="table-of-contents__link">Aggregated data upload</a></li><li><a href="#dataset-instances" class="table-of-contents__link">DataSet instances</a></li></ul></li><li><a href="#dealing-with-fileresources" class="table-of-contents__link">Dealing with FileResources</a><ul><li><a href="#file-resources-module" class="table-of-contents__link">File resources module</a></li><li><a href="#file-resizer-helper" class="table-of-contents__link">File resizer helper</a></li><li><a href="#file-resource-directory-helper" class="table-of-contents__link">File resource directory helper</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Interactive Apps Space.</div></div></div></footer></div>
<script src="/d2-touch/assets/js/styles.af9fa4f8.js"></script>
<script src="/d2-touch/assets/js/runtime~main.55cc834a.js"></script>
<script src="/d2-touch/assets/js/main.0a5d703f.js"></script>
<script src="/d2-touch/assets/js/1.9e39f1ba.js"></script>
<script src="/d2-touch/assets/js/2.4fae812d.js"></script>
<script src="/d2-touch/assets/js/3.bde55d57.js"></script>
<script src="/d2-touch/assets/js/1be78505.296c988f.js"></script>
<script src="/d2-touch/assets/js/28.4f63c7f5.js"></script>
<script src="/d2-touch/assets/js/935f2afb.70ae76b7.js"></script>
<script src="/d2-touch/assets/js/17896441.b056f953.js"></script>
<script src="/d2-touch/assets/js/195abf70.aceb4979.js"></script>
</body>
</html>